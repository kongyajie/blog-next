# Vueç³»åˆ—ä¹‹4-åŸç†

## å‰è¨€

- å‰ç«¯ä¸‰å¤§æ¡†æ¶å¯¹æ¯” 

| æ¡†æ¶ | å‘å¸ƒå¹´ä»½ | å‡ºè‡ª | staræ•° | ç‰¹æ€§ |
| --- | --- | --- | --- | --- |
| Angular | 2010å¹´ | Google | 73.7k | åŒå‘æ•°æ®ç»‘å®š |
| React | 2013å¹´ | Facebook | 169k | VirtualDOMã€Redux |
| Vue | 2014å¹´ | å°¤é›¨æºªEvanYou | 184k | æ›´è½»é‡ã€æ˜“äºä¸Šæ‰‹ã€ä¸­æ–‡æ–‡æ¡£å‹å¥½ |

- æ¡†æ¶è¶‹åŒ/äº’ç›¸å€Ÿé‰´
    - Vueå€Ÿé‰´knockoutæ¨¡æ¿å¼•æ“ã€å€Ÿé‰´AngularåŒå‘æ•°æ®ç»‘å®šã€å€Ÿé‰´Reactè™šæ‹Ÿdom/redux/JSX
    - è·¨ç«¯å¼€å‘ï¼ˆIonic/ReactNative/Weexï¼‰
    - æ¡Œé¢å¼€å‘ï¼ˆelectronæ”¯æŒvue/reactï¼‰
    - æ€»ä¹‹ï¼Œä½ æœ‰æˆ‘æœ‰å…¨éƒ½æœ‰ï¼Œå¤§å®¶å¥½æ‰æ˜¯çœŸçš„å¥½

- ç±»vueçš„å¼€å‘æ¨¡å¼ï¼ˆæ–°èµ›é“ï¼‰ï¼šå°ç¨‹åºã€uniapp

é˜…è¯»æœ¬æ–‡åä½ å°†äº†è§£åˆ°ï¼š
- Vueæ˜¯ä»€ä¹ˆï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
- MVVMæ¶æ„
- ä¸‰è¦ç´ ï¼ˆå“åº”å¼ã€æ¨¡æ¿ç¼–è¯‘ã€vdom/diffç®—æ³•ï¼‰
- ç»„ä»¶æ¸²æŸ“/æ›´æ–°è¿‡ç¨‹

PSï¼šæœ¬æ–‡å†…å®¹ä¸»è¦é’ˆå¯¹Vue2ï¼Œæ¶‰åŠå°‘é‡vue3.0å†…å®¹

## ä¸€ã€Vueæ˜¯ä»€ä¹ˆï¼Ÿ

**vueæ˜¯ä»€ä¹ˆï¼Ÿ**
> Vue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº **view**) æ˜¯ä¸€å¥—ç”¨äº**æ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼æ¡†æ¶**ã€‚ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸**ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“**ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨æä¾›é©±åŠ¨ã€‚

- è½»é‡çº§æ¸è¿›å¼æ¡†æ¶ï¼ˆä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆï¼‰
- ç”Ÿæ€ä¸°å¯Œï¼ˆvue-cliã€vue-routerã€vuexã€ç¤¾åŒºUIç»„ä»¶åº“...ï¼‰
- æ˜“äºä¸Šæ‰‹ï¼ˆå…¥é—¨ç®€å•ã€ä¸­æ–‡æ–‡æ¡£å‹å¥½ï¼‰

**vueè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ**
- **HTML**ï¼šä»0åˆ°1
- **CSS**ï¼šæä¾›è£…é¥°
- **JavaScript(DOM)**ï¼šæ”¯æŒé¡µé¢åŠ¨æ€åŒ–ï¼ˆä¾‹å¦‚å€’è®¡æ—¶ï¼‰
- **jQuery**ï¼šè§£å†³æµè§ˆå™¨å…¼å®¹é—®é¢˜ã€ä¼˜é›…APIï¼ˆè§£æ”¾å‰ç«¯ï¼Œé€ è½®å­ï¼‰
- **Vue**ï¼š**æ•°æ®é©±åŠ¨è§†å›¾**ï¼Œè®©å¼€å‘è€…ä»DOMæ“ä½œä¸­è§£æ”¾ï¼ˆå¦‚å€’è®¡æ—¶ï¼Œè‡ªåŠ å™¨ï¼‰

**ç–‘é—®ï¼šæ•°æ®é©±åŠ¨è§†å›¾æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿï¼ˆæ•°æ®å˜åŒ– -> è§†å›¾æ›´æ–°ï¼‰**

### 1ã€å¦‚ä½•ç†è§£MVVM

> MVVMæ˜¯ä¸€ç§è½¯ä»¶æ¶æ„æ¨¡å¼ï¼ŒMVVMæ˜¯MVPçš„å˜ä½“ï¼ŒMVPæ¨¡å¼å’ŒMVVMæ¨¡å¼éƒ½æ˜¯MVCæ¨¡å¼çš„å˜ä½“ã€‚[MVCï¼ŒMVP å’Œ MVVM çš„å›¾ç¤º](http://www.ruanyifeng.com/blog/2015/02/mvcmvp_mvvm.html)

> è½¯ä»¶æ„æ¶å¯¹ä»£ç è¿›è¡Œè§£è€¦åˆ†å±‚ï¼Œå„å±‚äº’ä¸å½±å“ï¼Œæœ‰æ•ˆé™ä½äº†å¼€å‘å¤æ‚åº¦ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´MVCä¸‰è€…ä¹‹å‰çš„é€šä¿¡æ¨¡å¼ï¼Œæ¥è¾¾åˆ°ä¸€å®šçš„æ¶æ„ç›®çš„ã€‚


MVVMå¯¹è§†å›¾æ›´æ–°æ¨¡å¼çš„å½±å“
- é™æ€æ¸²æŸ“ï¼šæ›´æ–°éœ€è¦è¿›è¡ŒDOMæ“ä½œï¼Œå¦‚ASP/JSP/PHPï¼Œé€‚åˆä¸šåŠ¡ç®€å•çš„åœºæ™¯
- æ•°æ®é©±åŠ¨è§†å›¾ï¼šé€šè¿‡æ•°æ®å³å¯æ›´æ–°è§†å›¾ï¼Œå¦‚Vue/React/Angularï¼Œé€‚åˆä¸šåŠ¡å¤æ‚çš„åœºæ™¯

MVVMåŒ…å«3éƒ¨åˆ†ï¼š
- **View**ï¼šç”¨æˆ·çœ‹åˆ°å±å¹•çš„ç»“æ„ã€å¸ƒå±€å’Œå¤–è§‚ï¼Œä¹Ÿç§°UI
- **ViewModel**ï¼šæ˜¯ä¸€ä¸ªç»‘å®šå™¨ï¼Œèƒ½å’Œ `View` å’Œ `Model` å±‚è¿›è¡Œé€šä¿¡
- **Model**ï¼šæ˜¯æ•°æ®å’Œé€»è¾‘

### 2ã€MVVMåœ¨Vueä¸­çš„ä½“ç°

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3e0fecfffa34c1f9e8d34572f52e7e2~tplv-k3u1fbpfcp-watermark.image)

ç¤ºä¾‹ï¼š

```html
<template>
    <div id="app">
      <h1>{{ message }}</h1>
      <button @click="reverse">reverse</button>
    </div>
</template>
```

```js
var app = new Vue({
    el: "#app",
    data: {
      message: "Hello Vue123!!"
    },
    methods: {
      reverse() {
        this.message = this.message.split("").reverse().join("");
      }
    }
});
```

- View: templateæ¨¡æ¿
- Model: dataæ•°æ®
- ViewModel: Vueå®ä¾‹

PSï¼šVueæ²¡æœ‰ä¸¥æ ¼éµå¾ª MVVM æ¨¡å¼ï¼šä¸¥æ ¼çš„MVVMè¦æ±‚Viewä¸èƒ½å’ŒModelç›´æ¥é€šä¿¡ï¼Œè€ŒVueåœ¨ç»„ä»¶ä¸­æä¾›äº†$refsè¿™ä¸ªå±æ€§ï¼Œè®©Modelå¯ä»¥ç›´æ¥æ“ä½œViewï¼Œè¿åäº†è¿™ä¸€è§„å®šã€‚

**ç–‘é—®ï¼švueæ˜¯å¦‚ä½•å®ç°MVVMçš„ï¼Ÿ**

### 3ã€Vueä¸‰è¦ç´ 

- å“åº”å¼ï¼švueå¦‚ä½•ç›‘å¬åˆ° data çš„æ¯ä¸ªå±æ€§å˜åŒ–ï¼Ÿ
- æ¨¡æ¿å¼•æ“ï¼švueçš„æ¨¡æ¿å¦‚ä½•è¢«è§£æï¼Ÿ
- æ¸²æŸ“ï¼švueå¦‚ä½•è¿›è¡Œé«˜æ•ˆæ¸²æŸ“ï¼Ÿ

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa6b219179c14b13abd1d436703e2099~tplv-k3u1fbpfcp-watermark.image)

## äºŒã€Vueä¸‰è¦ç´ -å“åº”å¼
> å“åº”å¼ï¼šç»„ä»¶ data çš„æ•°æ®ä¸€æ—¦å˜åŒ–ï¼Œç«‹åˆ»è§¦å‘è§†å›¾çš„æ›´æ–°ã€‚
å“åº”å¼å¦‚ä½•å®ç°ï¼Ÿ

### Object.definePropertyï¼ˆIE9+ï¼‰
```js
let obj = {};
let value = null;
Object.defineProperty(obj, 'a', {
    get: () => {
        console.log('trigger get');
        // æ”¶é›†ä¾èµ– todo...
        return value;
    },
    set: (val) => {
        console.log('trigger set');
        if (val !== value) {
            value = val;
            // æ•°æ®å˜æ›´ï¼Œéœ€è¦é‡æ–°æ¸²æŸ“ todo...
        }
        
    }
})
console.log(obj.a);
obj.a = 1;
```

ç¼ºç‚¹
- æ·±åº¦ç›‘å¬éœ€è¦é€’å½’åˆ°åº•ï¼Œä¸€æ¬¡æ€§è®¡ç®—é‡å¤§
- æ— æ³•ç›‘å¬æ–°å¢å±æ€§/åˆ é™¤å±æ€§ï¼ˆVue.$setï¼‰
- æ— æ³•åŸç”Ÿç›‘å¬æ•°ç»„ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†

### proxyï¼ˆVue3.0ï¼ŒIE11+ï¼‰

```js
let obj = {}
let reactiveObj = new Proxy(obj, {
    get: function(obj, prop) {
        console.log('trigger get');
        // æ”¶é›†ä¾èµ– todo...
        return obj[prop];
    },
    set: function(obj, prop, value) {
        console.log('trigger set');
        obj[prop] = value;
        if (obj[prop] !== value) {
            // æ•°æ®å˜æ›´ï¼Œéœ€è¦é‡æ–°æ¸²æŸ“ todo...
        }
    }
})
```
ç¼ºç‚¹ï¼š
- æœ‰å…¼å®¹æ€§çš„é—®é¢˜ï¼Œcaniuse 95%
- å®ƒä¼šä¿®æ”¹JavaScriptçš„ä¸€äº›åº•å±‚ä»£ç çš„æ‰§è¡Œæ–¹å¼ï¼Œæ‰€ä»¥å®ƒæ˜¯æ— æ³•è¢«å®Œå…¨polyfillçš„

å“åº”å¼å¸¦æ¥çš„é—®é¢˜ï¼š
- jQueryå¯ä»¥è‡ªè¡Œæ§åˆ¶DOMæ“ä½œçš„æ—¶æœºï¼Œæ‰‹åŠ¨è°ƒæ•´ï¼Œè€Œå“åº”å¼çš„DOMæ“ä½œåˆ™åœ¨å†…éƒ¨è¿›è¡Œï¼›
- DOM æ“ä½œéå¸¸è€—è´¹æ€§èƒ½

**ç–‘é—®ï¼šå¦‚ä½•æœ‰æ•ˆæ§åˆ¶DOMæ“ä½œï¼Ÿ**

## ä¸‰ã€Vueä¸‰è¦ç´ -æ¸²æŸ“ï¼šè™šæ‹ŸDOMï¼ˆVirtual DOMï¼‰
> Vueæ˜¯æ•°æ®é©±åŠ¨è§†å›¾ï¼Œå¦‚ä½•æœ‰æ•ˆæ§åˆ¶DOMæ“ä½œï¼Ÿ

- è§£å†³æ–¹æ¡ˆï¼š`vdom`
    - JSæ‰§è¡Œé€Ÿåº¦å¿«
    - ç”¨JSæ¨¡æ‹ŸDOMç»“æ„ï¼Œè®¡ç®—å‡ºæœ€å°çš„å˜æ›´ï¼Œæ“ä½œDOM
- `vdom` æ˜¯ä¼˜åŒ–æ–¹æ¡ˆï¼Œä¸æ˜¯å“åº”å¼å¿…é¡»
    - `vdom` æ˜¯å®ç° `vue` å’Œ `react` çš„é‡è¦åŸºçŸ³
    - `diffç®—æ³•` æ˜¯ `vdom` ä¸­æœ€æ ¸å¿ƒã€æœ€å…³é”®çš„éƒ¨åˆ†
- ç”¨JSæ¨¡æ‹ŸDOMç»“æ„ï¼š`vnode`

```html
<div id="div1" class="container">
    <p>vdom</p>
    <ul style="font-size: 20px;">
        <li>a</li>
    </ul>
</div>
```
```js
{
    tag: 'div',
    props: {
        classname: 'container',
        id: 'div1'
    },
    children: [
        {
            tag: 'p',
            children: 'vdom'
        },
        {
            tag: 'ul',
            props: { style: 'font-size: 20px;' },
            children: [
                {
                    tag: 'li',
                    children: 'a'
                }
            ]
        }
    ]
}
```

- `vdom` å°ç»“ï¼šæ•°æ®é©±åŠ¨è§†å›¾çš„æ¨¡å¼ä¸‹ï¼Œæœ‰æ•ˆæ§åˆ¶DOMæ“ä½œ
    - `vnode`ï¼šç”¨JSæ¨¡æ‹ŸDOMç»“æ„
    - `diffç®—æ³•`ï¼šæ–°æ—§vnodeå¯¹æ¯”ï¼Œå¾—å‡ºæœ€å°æ›´æ–°èŒƒå›´ï¼Œæœ€åæ›´æ–°DOM

## å››ã€diffç®—æ³•-vdomæ ¸å¿ƒéƒ¨åˆ†
> diff ç®—æ³•æ˜¯ä¸€ç§é€šè¿‡åŒå±‚çš„æ ‘èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒçš„é«˜æ•ˆç®—æ³•ï¼Œé¿å…äº†å¯¹æ ‘è¿›è¡Œé€å±‚æœç´¢éå†ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦åªæœ‰ O(n)

### æ¦‚è¿°ï¼š
- diffå³å¯¹æ¯”ï¼Œæ˜¯ä¸€ä¸ªå¹¿æ³›çš„æ¦‚å¿µï¼ˆéç‹¬åˆ›ï¼‰ï¼Œå¦‚linux diffå‘½ä»¤ï¼Œgit diffç­‰
- ä¸¤ä¸ªjså¯¹è±¡ä¹Ÿå¯ä»¥åšdiff
- ä¸¤æ£µæ ‘åšdiffï¼Œå¦‚è¿™é‡Œçš„vdom diff

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/286a4362483c4cafb3fb8615cefe94bc~tplv-k3u1fbpfcp-watermark.image)
    
### æ ‘diffçš„æ—¶é—´å¤æ‚åº¦O(n^3)
- 1ã€éå†tree1
- 2ã€éå†tree2
- 3ã€æ’åº
- 1000ä¸ªèŠ‚ç‚¹ï¼Œè¦è®¡ç®—1äº¿æ¬¡ï¼Œç®—æ³•ä¸å¯ç”¨

### ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦åˆ°O(n)
- åªæ¯”è¾ƒåŒä¸€å±‚çº§ï¼Œä¸è·¨çº§æ¯”è¾ƒ
- tagä¸ç›¸åŒï¼Œåˆ™ç›´æ¥åˆ æ‰é‡å»ºï¼Œä¸å†æ·±åº¦æ¯”è¾ƒ
- tagå’Œkeyï¼Œä¸¤è€…éƒ½ç›¸åŒï¼Œåˆ™è®¤ä¸ºæ˜¯ç›¸åŒèŠ‚ç‚¹ï¼Œæ›´æ–°domï¼Œå¹¶ç»§ç»­æ¯”è¾ƒèŠ‚ç‚¹çš„å­å…ƒç´ 

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39a203ea582649f5aba9bf27f86aada7~tplv-k3u1fbpfcp-watermark.image)
    
![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68ef124893964d349a15fa4f32759b2d~tplv-k3u1fbpfcp-watermark.image)

### diffç®—æ³•æµç¨‹
1ã€é¦–æ¬¡æ¸²æŸ“ï¼Œå–vnodeè¿›è¡Œæ¸²æŸ“å³å¯

2ã€æ•°æ®æ›´æ–°åï¼Œå°†vnodeå’ŒoldVnodeè¿›è¡Œå¯¹æ¯”
- ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œåˆ¤æ–­å½“å‰çš„æ—§èŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹æ˜¯å¦åŒä¸€èŠ‚ç‚¹ï¼ˆselå’Œkeyç›¸åŒï¼‰
- è‹¥ä¸æ˜¯åŒä¸€èŠ‚ç‚¹ï¼Œåˆ™åˆ æ‰é‡å»ºï¼›
- è‹¥æ˜¯åŒä¸€èŠ‚ç‚¹ï¼Œåˆ™æ›´æ–°å½“å‰èŠ‚ç‚¹domï¼Œç»§ç»­å¤„ç†å­å…ƒç´ children
  

3ã€**å­å…ƒç´ childrençš„å¯¹æ¯”ç®—æ³•**ï¼ˆå°½å¯èƒ½å¤šåœ°å¤ç”¨çœŸå®DOM,å°½å¯èƒ½å°‘çš„æ·»åŠ åˆ é™¤çœŸå®DOMï¼‰
æ€è·¯ï¼šæ·»åŠ 4ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘æ–°æ—§childrençš„å¼€å§‹å’Œç»“æŸæ¯”è¾ƒçš„è¿‡ç¨‹ä¸­ï¼Œå¾ªç¯ä»ä¸¤è¾¹å‘ä¸­é—´æ”¶æ‹¢ï¼›
- ç¬¬ä¸€æ­¥ï¼šåˆ†åˆ«è¿›è¡Œå¼€å§‹å¼€å§‹ã€ç»“æŸç»“æŸã€å¼€å§‹ç»“æŸã€ç»“æŸå¼€å§‹å¯¹æ¯”ï¼Œè‹¥åŒ¹é…æˆåŠŸï¼Œåˆ™æŒ‡é’ˆå‘ä¸­é—´æ”¶æ‹¢ï¼›
- ç¬¬äºŒæ­¥ï¼šè‹¥ç¬¬ä¸€æ­¥æœªåŒ¹é…ï¼Œåˆ™åœ¨æ—§childrenä¸­éå†æŸ¥æ‰¾æ˜¯å¦åŒ¹é…æ–°childrençš„å¼€å§‹èŠ‚ç‚¹ï¼Œè‹¥åŒ¹é…æˆåŠŸï¼Œåˆ™ç§»åŠ¨æ—§èŠ‚ç‚¹åˆ°å¯¹åº”ä½ç½®ï¼›
- ç¬¬ä¸‰æ­¥ï¼šå¾ªç¯ç»“æŸåï¼Œæ ¹æ®æ–°è€èŠ‚ç‚¹çš„æ•°ç›®ä¸åŒåšç›¸åº”çš„æ·»åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹æ“ä½œ

å„åœºæ™¯å›¾ç¤ºï¼ˆè¿™é‡Œçœ‹åŠ¨ç”» ğŸ‘‰  [diffç®—æ³•å›¾è§£åŠ¨ç”»](https://www.bilibili.com/video/BV1b5411V7i3?from=search&seid=4125072074822008044)ï¼‰
- k -> key
- a/b/c/d -> å…ƒç´ å†…å®¹
- æ‰€æœ‰å…ƒç´ çš„tagéƒ½ç›¸åŒï¼Œå¯ä»¥ç†è§£å‡ä¸º `<li>`

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d0d8dca6afe24cd795af2edc2be7e049~tplv-k3u1fbpfcp-watermark.image)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5295957102da4ba2b13eb6c8c65b4f73~tplv-k3u1fbpfcp-watermark.image)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ee3dec92df84644982cfb237166e12c~tplv-k3u1fbpfcp-watermark.image)

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e62d8912026f4bbf9f1975de26b8de73~tplv-k3u1fbpfcp-watermark.image)

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ad12f271b8484572b14e32048fbba20f~tplv-k3u1fbpfcp-watermark.image)

åˆ é™¤èŠ‚ç‚¹
![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f94f32ebd3040c9bec27350e554f8cf~tplv-k3u1fbpfcp-watermark.image)

æ–°å¢èŠ‚ç‚¹
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5bdb95ad733f414f9542a5ebb4ec9175~tplv-k3u1fbpfcp-watermark.image)

æœªè®¾ç½®key
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/027885ad98f7446d8eefa107c481c6a7~tplv-k3u1fbpfcp-watermark.image)

è®¾ç½®key
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50d9e7701ad14f779de617fb3368fc3c~tplv-k3u1fbpfcp-watermark.image)

éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒèŠ‚ç‚¹çš„æ›´æ–°æœ‰ä¸‰ç§å¼€é”€ï¼š

- ç¬¬ä¸€ç§æ˜¯ä¸èƒ½å¤ç”¨èŠ‚ç‚¹æ—¶ï¼Œé‡å»ºèŠ‚ç‚¹ï¼Œæ›´æ–°dom
- ç¬¬äºŒç§æ˜¯èƒ½å¤ç”¨èŠ‚ç‚¹æ—¶ï¼Œç›´æ¥æ›´æ–°dom
- ç¬¬ä¸‰ç§æ˜¯èƒ½å¤ç”¨èŠ‚ç‚¹ï¼Œä½†éœ€ç§»åŠ¨domï¼Œç„¶åæ›´æ–°

æ•°ç»„åŠ keyå³ç¬¦åˆç¬¬ä¸‰ç§æƒ…å†µã€‚

## äº”ã€Vueä¸‰è¦ç´ -æ¨¡æ¿ç¼–è¯‘
- æ¦‚è§ˆ
    - å‰ç½®çŸ¥è¯†ï¼šJSçš„withè¯­æ³•
        - æ”¹å˜{}å†…è‡ªç”±å˜é‡çš„æŸ¥æ‰¾è§„åˆ™ï¼Œå½“åšobjå±æ€§æ¥æŸ¥æ‰¾
        - å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„objå±æ€§ï¼Œå°±ä¼šæŠ¥é”™
        - withè¦æ…ç”¨ï¼Œå®ƒæ‰“ç ´äº†ä½œç”¨åŸŸè§„åˆ™ï¼Œæ˜“è¯»æ€§å˜å·®
    - vueæ¨¡æ¿(ä¸æ˜¯htmlï¼Œæœ‰æŒ‡ä»¤ã€æ’å€¼ã€JSè¡¨è¾¾å¼)åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ
    - vueå¦‚ä½•å¤„ç†æ¨¡æ¿ï¼Ÿç»„ä»¶æ¸²æŸ“å’Œæ›´æ–°è¿‡ç¨‹ï¼Ÿ
- æ­¥éª¤ï¼š
    1. **vue-template-complierå°†æ¨¡æ¿`<template>`ç¼–è¯‘ä¸º render å‡½æ•°**
    2. **æ‰§è¡Œ render å‡½æ•°ç”Ÿæˆ vnode**
    3. åŸºäº vnode å†æ‰§è¡Œ patch å’Œ diffï¼Œè¿›è¡Œæ¸²æŸ“å’Œæ›´æ–°
    4. ä¿®æ”¹æ•°æ®åï¼Œä¼šç”Ÿæˆæ–°çš„vnode
    
- vueæ¨¡æ¿è¢«ç¼–è¯‘æˆä»€ä¹ˆï¼ˆ `vue-template-compiler` ï¼‰

`<p>{{message}}</p>`

`with(this){return _c('p', [_v(_s(message))])}`

ç±»ä¼¼äºï¼š

```js
render: function (createElement) {
    return createElement(
      'p',   // æ ‡ç­¾åç§°
      this.message.toString() // å­èŠ‚ç‚¹æ•°ç»„
    )
},
```

- å…¶ä»–æ³¨æ„ç‚¹ï¼š
    - ä½¿ç”¨webpack vue-loaderï¼Œä¼šåœ¨å¼€å‘ç¯å¢ƒç¼–è¯‘æ¨¡æ¿
    - vueç»„ä»¶å¯ä»¥ç”¨renderä»£æ›¿templateï¼Œreacté»˜è®¤ä½¿ç”¨renderå†™æ³•

## å…­ã€Vueçš„ç»„ä»¶æ¸²æŸ“/æ›´æ–°è¿‡ç¨‹

- åˆæ¬¡æ¸²æŸ“è¿‡ç¨‹
    1. è§£ææ¨¡æ¿ä¸ºrenderå‡½æ•°ï¼ˆæˆ–åœ¨å¼€å‘ç¯å¢ƒå·²å®Œæˆï¼Œvue-loaderï¼‰
    2. ï¼ˆé¡µé¢æ¸²æŸ“æ—¶ï¼‰æ‰§è¡Œrenderå‡½æ•°ï¼Œç”Ÿæˆvnodeï¼Œpatch(elem,vnode)
    3. è§¦å‘å“åº”å¼ï¼Œç›‘å¬dataå±æ€§getter setter
- æ›´æ–°è¿‡ç¨‹
    1. ä¿®æ”¹dataï¼Œè§¦å‘setterï¼ˆæ­¤å‰åœ¨getterä¸­å·²è¢«ç›‘å¬ï¼‰
    2. é‡æ–°æ‰§è¡Œrenderå‡½æ•°ï¼Œç”ŸæˆnewVnode
    3. å¯¹æ¯”æ–°æ—§vnodeï¼Œpatch(vnode,newVnode)ï¼Œæ›´æ–°åˆ°domä¸Š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/981c630c3aa8411d888a6c2442a88baa~tplv-k3u1fbpfcp-watermark.image)

## ä¸ƒã€Vue3.0çš„æ€§èƒ½ä¼˜åŒ–
> æ€§èƒ½æ¯”vue2.xå¿«1.2ï½2å€

- **é™æ€æ ‡è®°**ï¼šdiffæ–¹æ³•ä¼˜åŒ–vue2.xä¸­çš„è™šæ‹Ÿdomæ˜¯è¿›è¡Œå…¨é‡çš„å¯¹æ¯”ã€‚è€Œvue3.0æ–°å¢äº†é™æ€æ ‡è®°ã€‚åœ¨ä¸ä¸Šæ¬¡è™šæ‹ŸèŠ‚ç‚¹è¿›è¡Œå¯¹æ¯”çš„æ—¶å€™ï¼Œåªå¯¹æ¯”å¸¦æœ‰patch flagçš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡flagçš„ä¿¡æ¯å¾—çŸ¥å½“å‰èŠ‚ç‚¹è¦å¯¹æ¯”çš„å…·ä½“å†…å®¹ã€‚

- **é™æ€æå‡**ï¼švue2.xä¸­æ— è®ºå…ƒç´ æ˜¯å¦å‚ä¸æ›´æ–°ï¼Œæ¯æ¬¡éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œç„¶åå†æ¸²æŸ“ã€‚vue3.0ä¸­å¯¹äºä¸å‚ä¸æ›´æ–°çš„å…ƒç´ ï¼Œä¼šåšé™æ€æå‡ï¼Œåªä¼šè¢«åˆ›å»ºä¸€æ¬¡ï¼Œåœ¨æ¸²æŸ“æ—¶ç›´æ¥å¤ç”¨å³å¯ã€‚

- **äº‹ä»¶ä¾¦å¬å™¨ç¼“å­˜**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚onClickäº‹ä»¶ä¼šè¢«è§†ä¸ºåŠ¨æ€ç»‘å®šï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½ä¼šè¿½è¸ªå®ƒçš„å˜åŒ–ï¼Œä½†æ˜¯å› ä¸ºæ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ä¸ç”¨è¿½è¸ªå˜åŒ–ï¼Œç›´æ¥ç¼“å­˜èµ·æ¥å¤ç”¨å³å¯ã€‚


## å›é¡¾
- Vueæ˜¯ä»€ä¹ˆï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
- MVVMæ¶æ„
- ä¸‰è¦ç´ ï¼šå“åº”å¼ã€æ¨¡æ¿ç¼–è¯‘ã€vdom/diffç®—æ³•ï¼ˆé‡è¦ï¼‰
- ç»„ä»¶æ¸²æŸ“/æ›´æ–°è¿‡ç¨‹ï¼ˆé‡è¦ï¼‰
- å¼‚æ­¥æ¸²æŸ“
    - $nextTick
    - æ±‡æ€»dataçš„ä¿®æ”¹ï¼Œä¸€æ¬¡æ€§æ›´æ–°è§†å›¾
    - å‡å°‘DOMæ“ä½œæ¬¡æ•°ï¼Œæé«˜æ€§èƒ½

## å‚è€ƒ
- [vueçš„diffç®—æ³•æ‰§è¡Œè¿‡ç¨‹è§£æ](https://www.infoq.cn/article/udlcpkh4iqb0cr5wgy7f)
- [diffç®—æ³•å›¾è§£åŠ¨ç”»](https://www.bilibili.com/video/BV1b5411V7i3?from=search&seid=4125072074822008044)
- [Vue3.0æ˜¯å¦‚ä½•å˜å¿«çš„](https://developer.51cto.com/art/202010/628347.htm)

